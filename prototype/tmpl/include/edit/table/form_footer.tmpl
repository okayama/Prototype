<input type="hidden" name="__validation" id="__validation">

<mt:var name="request.id" setvar="table_id">
<mt:objectloop model="column" sort_by="order" table_id="$table_id">
<mt:setvarblock name="column_header">
<tr>
<th><mt:trans phrase="Name"></th>
<th><mt:trans phrase="Label"></th>
<th><mt:trans phrase="Type"></th>
<mt:ignore><th><mt:trans phrase="Size"></th></mt:ignore>
<th><mt:trans phrase="Order"></th>
<th><mt:trans phrase="NOT NULL"></th>
<th><mt:trans phrase="Index"></th>
<th><mt:trans phrase="Unique"></th>
<th><mt:trans phrase="Uneditable"></th>
<th><mt:trans phrase="List Type"></th>
<th><mt:trans phrase="Edit Type"></th>
<th><mt:trans phrase="Delete"></th>
<th><mt:trans phrase="Detail"></th>
</tr>
</mt:setvarblock>

<mt:if name="__first__">
<h2><mt:trans phrase="Columns">
<button type="button" id="add_col" class="btn btn-secondary"><mt:trans phrase="Add">
</h2>

<table class="table table-striped table-sm table-hover">
<thead>
<mt:var name="column_header">
</thead>
<tbody id="cols_tbl">
</mt:if>
<tr id="_column_<mt:var name="id">">
<td>
<input type="hidden" name="_column_id[]" value="<mt:var name="id">">
<input id="_name_<mt:var name="id">" name="_name_<mt:var name="id">" type="text" class="form-control" value="<mt:var name="name" escape>" readonly></td>
<td><input id="_label_<mt:var name="id">" name="_label_<mt:var name="id">" type="text" class="form-control" value="<mt:var name="label" escape>"<mt:if name="is_primary"> readonly</mt:if>></td>
<td>
<mt:if name="type" eq="tinyint">
<mt:setvar name="column_type" value="boolean">
<mt:elseif name="type" eq="int">
<mt:setvar name="column_type" value="integer">
<mt:elseif name="type" eq="datetime">
<mt:setvar name="column_type" value="datetime">
<mt:elseif name="type" eq="string">
<mt:setvar name="column_type" value="string">
<mt:elseif name="type" eq="text">
<mt:setvar name="column_type" value="text">
<mt:elseif name="type" eq="blob">
<mt:setvar name="column_type" value="blob">
<mt:elseif name="type" eq="relation">
<mt:setvar name="column_type" value="relation">
</mt:if>
<select id="_type_<mt:var name="id">" name="_type_<mt:var name="id">" class="form-control col_types<mt:if name="not_delete"> readonly</mt:if>"<mt:if name="is_primary"> disabled</mt:if><mt:if name="not_delete"> onmousedown="return false;" onkeydown="return false;"</mt:if>>
  <option value="integer"<mt:if name="column_type" eq="integer"> selected</mt:if>><mt:trans phrase="Integer"></option>
  <option value="boolean"<mt:if name="column_type" eq="boolean"> selected</mt:if>><mt:trans phrase="Boolean"></option>
  <option value="string"<mt:if name="column_type" eq="string"> selected</mt:if>><mt:trans phrase="String"></option>
  <option value="text"<mt:if name="column_type" eq="text"> selected</mt:if>><mt:trans phrase="Large Text"></option>
  <option value="datetime"<mt:if name="column_type" eq="datetime"> selected</mt:if>><mt:trans phrase="DateTime"></option>
  <option value="blob"<mt:if name="column_type" eq="blob"> selected</mt:if>><mt:trans phrase="Blob"></option>
  <option value="relation"<mt:if name="column_type" eq="relation"> selected</mt:if>><mt:trans phrase="Relation"></option>
</select>

</td>
<mt:ignore><td><input id="_size_<mt:var name="id">" name="_size_<mt:var name="id">" type="number" class="form-control num" value="<mt:var name="size" escape>"<mt:if name="not_delete"> readonly</mt:if><mt:if name="is_primary"> disabled</mt:if>></td></mt:ignore>
<td><input id="_order_<mt:var name="id">" name="_order_<mt:var name="id">" type="number" class="form-control single order_col" value="<mt:var name="order" escape>"></td>
<td>

<input id="_size_<mt:var name="id">" name="_size_<mt:var name="id">" type="hidden" value="<mt:var name="size" escape>">
<input id="_options_<mt:var name="id">" name="_options_<mt:var name="id">" type="hidden" value="<mt:var name="options" escape>">
<input id="_disp_edit_<mt:var name="id">" name="_disp_edit_<mt:var name="id">" type="hidden" value="<mt:var name="disp_edit" escape>">
<input id="_autoset_<mt:var name="id">" name="_autoset_<mt:var name="id">" type="hidden" value="<mt:var name="autoset" escape>">

<mt:unless name="is_primary"><input id="_not_null_<mt:var name="id">" name="_not_null_<mt:var name="id">" type="checkbox" class="form-control" value="1"<mt:if name="not_null"> checked</mt:if><mt:if name="not_delete"> onclick="return false;" onkeydown="return false;"</mt:if>><mt:else><input type="checkbox" checked disabled></mt:unless></td>
<td><mt:unless name="is_primary"><input id="_index_<mt:var name="id">" name="_index_<mt:var name="id">" type="checkbox" class="form-control" value="1"<mt:if name="index"> checked</mt:if><mt:if name="not_delete"> onclick="return false;" onkeydown="return false;"</mt:if>><mt:else><input type="checkbox" checked disabled><input name="index_<mt:var name="id">" type="hidden" value="PRIMARY"></mt:unless></td>
<td><mt:unless name="is_primary"><input id="_unique_<mt:var name="id">" name="_unique_<mt:var name="id">" type="checkbox" class="form-control" value="1"<mt:if name="unique"> checked</mt:if><mt:if name="not_delete"> onclick="return false;" onkeydown="return false;"</mt:if>><mt:else><input type="checkbox" checked disabled></mt:unless></td>
<td><mt:unless name="is_primary"><input id="_unchangeable_<mt:var name="id">" name="_unchangeable_<mt:var name="id">" type="checkbox" class="form-control" value="1"<mt:if name="unchangeable"> checked</mt:if><mt:if name="not_delete"> onclick="return false;" onkeydown="return false;"</mt:if>><mt:else><input type="checkbox" checked disabled></mt:unless></td>

<td><mt:unless name="is_primary">

<select id="_list_<mt:var name="id">" name="_list_<mt:var name="id">" class="form-control<mt:if name="not_delete"> readonly</mt:if>"<mt:if name="not_delete"> onmousedown="return false;" onkeydown="return false;"</mt:if>>
  <option value=""<mt:unless name="list"> selected</mt:unless>><mt:trans phrase="None"></option>
  <option value="checkbox"<mt:if name="list" eq="checkbox"> selected</mt:if>><mt:trans phrase="Checkbox"></option>
  <option value="number"<mt:if name="list" eq="number"> selected</mt:if>><mt:trans phrase="Number"></option>
  <option id="_list_primary_<mt:var name="id">" value="primary"<mt:if name="list" eq="primary"> selected</mt:if>><mt:trans phrase="Primary"></option>
  <option value="text"<mt:if name="list" eq="text"> selected</mt:if>><mt:trans phrase="Text Box"></option>
  <option value="text_short"<mt:if name="list" eq="text_short"> selected</mt:if>><mt:trans phrase="Short Text"></option>
  <option value="password"<mt:if name="list" eq="password"> selected</mt:if>><mt:trans phrase="Password"></option>
  <option id="_list_datetime_<mt:var name="id">" value="datetime"<mt:if name="list" eq="datetime"> selected</mt:if>><mt:trans phrase="DateTime"></option>
  <option id="_list_date_<mt:var name="id">" value="date"<mt:if name="list" eq="date"> selected</mt:if>><mt:trans phrase="Date"></option>
  <option id="_list_popover_<mt:var name="id">" value="popover"<mt:if name="list" eq="popover"> selected</mt:if>><mt:trans phrase="Popover"></option>
<mt:if name="list" like=":">
  <option value="<mt:var name="list" escape>" class="custom" selected><mt:trans phrase="Custom"></option>
<mt:else>
  <option value="custom" class="custom"><mt:trans phrase="Custom"></option>
</mt:if>
</select>

<mt:else><input type="checkbox" name="_list_<mt:var name="id">" value="1" <mt:if name="list">checked</mt:if>></mt:unless></td>

<td><mt:unless name="is_primary">
<select id="_edit_<mt:var name="id">" name="_edit_<mt:var name="id">" class="list_edit_prop form-control<mt:if name="not_delete"> readonly</mt:if>"<mt:if name="not_delete"> onmousedown="return false;" onkeydown="return false;"</mt:if>>
  <option value=""<mt:unless name="edit"> selected</mt:unless>><mt:trans phrase="None"></option>
  <option value="hidden"<mt:if name="edit" eq="hidden"> selected</mt:if>><mt:trans phrase="Hidden"></option>
  <option value="checkbox"<mt:if name="edit" eq="checkbox"> selected</mt:if>><mt:trans phrase="Checkbox"></option>
  <option value="number"<mt:if name="edit" eq="number"> selected</mt:if>><mt:trans phrase="Number"></option>
  <option id="_edit_primary_<mt:var name="id">" value="primary"<mt:if name="edit" eq="primary"> selected</mt:if>><mt:trans phrase="Primary"></option>
  <option value="text"<mt:if name="edit" eq="text"> selected</mt:if>><mt:trans phrase="Text Box"></option>
  <option value="text_short"<mt:if name="edit" eq="text_short"> selected</mt:if>><mt:trans phrase="Short Text"></option>
  <option id="_edit_selection_<mt:var name="id">" value="selection"<mt:if name="edit" eq="selection"> selected</mt:if>><mt:trans phrase="Selection"></option>
  <option value="password"<mt:if name="edit" eq="password"> selected</mt:if>><mt:trans phrase="Password"></option>
  <option value="password(hash)"<mt:if name="edit" eq="password(hash)"> selected</mt:if>><mt:trans phrase="Password(Hashed)"></option>
  <option value="textarea"<mt:if name="edit" eq="textarea"> selected</mt:if>><mt:trans phrase="Textarea"></option>
  <option id="_edit_richtext_<mt:var name="id">" value="richtext"<mt:if name="edit" eq="richtext"> selected</mt:if>><mt:trans phrase="RichText"></option>
  <option id="_edit_datetime_<mt:var name="id">" value="datetime"<mt:if name="edit" eq="datetime"> selected</mt:if>><mt:trans phrase="DateTime"></option>
  <option id="_edit_color_<mt:var name="id">" value="color"<mt:if name="edit" eq="color"> selected</mt:if>><mt:trans phrase="Color"></option>
  <option value="languages"<mt:if name="edit" eq="languages"> selected</mt:if>><mt:trans phrase="Languages"></option>
  <option id="_edit_file_<mt:var name="id">" value="file"<mt:if name="edit" eq="file"> selected</mt:if>><mt:trans phrase="File"></option>
<mt:if name="edit" like=":">
  <option value="<mt:var name="edit" escape>" class="custom" selected><mt:trans phrase="Custom"></option>
<mt:else>
  <option value="custom" class="custom"><mt:trans phrase="Custom"></option>
</mt:if>
</select>

<mt:else><input type="checkbox" checked disabled></mt:unless></td>
<td>
  <mt:unless name="not_delete">
  <mt:unless name="is_primary"><mt:if name="name" ne="$_primary_"><button type="button" class="btn btn-outline-danger tr-delete"><mt:trans phrase="Delete"></button></mt:if></mt:unless>
  </mt:unless>
</td>
<td>
  <mt:unless name="not_delete">
  <mt:unless name="is_primary"><mt:if name="name" ne="$_primary_">
  <button name="_detail-<mt:var name="id">" type="button" class="btn btn-outline-primary detail-btn" data-toggle="modal" data-target="#_col_options">
    <mt:trans phrase="Detail">
  </button>
  </mt:if></mt:unless>
  </mt:unless>
</td>
</tr>
<mt:if name="__last__">

<tr id="col_tmpl" style="display:none">
<td>
<input type="hidden" name="_new_column[]" value="">
<input name="_new_name_" type="text" class="form-control col-input" value=""></td>
<td><input name="_new_label_" type="text" class="form-control label-input" value=""></td>
<td>
<select name="_new_type_" class="form-control col_types">
  <option value="integer"><mt:trans phrase="Integer"></option>
  <option value="boolean"><mt:trans phrase="Boolean"></option>
  <option value="string"><mt:trans phrase="String"></option>
  <option value="text"><mt:trans phrase="Large Text"></option>
  <option value="datetime"><mt:trans phrase="DateTime"></option>
  <option value="blob"><mt:trans phrase="Blob"></option>
  <option value="relation"><mt:trans phrase="Relation"></option>
</select>
</td>
<mt:ignore><td><input name="_new_size_" type="number" class="form-control num" value=""></td></mt:ignore>
<td><input name="_new_order_" type="number" class="form-control single" value=""></td>
<td>
<input id="_new_options_" name="_new_options_" type="hidden" value="">
<input id="_new_disp_edit_" name="_new_disp_edit_" type="hidden" value="">
<input id="_new_autoset_" name="_new_autoset_" type="hidden" value="">

<input name="_new_not_null_" type="checkbox" class="form-control" value="1"></td>
<td><input name="_new_index_" type="checkbox" class="form-control" value="1"></td>
<td><input name="_new_unique_" type="checkbox" class="form-control" value="1"></td>
<td><input name="_new_unchangeable_" type="checkbox" class="form-control" value="1"></td>
<td>
<select name="_new_list_" class="form-control">
  <option value=""><mt:trans phrase="None"></option>
  <option value="checkbox"><mt:trans phrase="Checkbox"></option>
  <option value="number"><mt:trans phrase="Number"></option>
  <option id="_new_list_primary_" value="primary"><mt:trans phrase="Primary"></option>
  <option value="text"><mt:trans phrase="Text Box"></option>
  <option value="text_short"><mt:trans phrase="Short Text"></option>
  <option value="password"><mt:trans phrase="Password"></option>
  <option id="_new_list_datetime_" value="datetime"><mt:trans phrase="DateTime"></option>
  <option id="_new_list_date_" value="date"><mt:trans phrase="Date"></option>
  <option id="_new_list_popover_" value="popover"><mt:trans phrase="Popover"></option>
  <option value="custom" class="custom"><mt:trans phrase="Custom"></option>
</select>
</td>
<td>
<select name="_new_edit_" class="list_edit_prop form-control">
  <option value=""><mt:trans phrase="None"></option>
  <option value="hidden"><mt:trans phrase="Hidden"></option>
  <option value="checkbox"><mt:trans phrase="Checkbox"></option>
  <option value="number"><mt:trans phrase="Number"></option>
  <option id="_new_edit_primary_" value="primary"><mt:trans phrase="Primary"></option>
  <option value="text"><mt:trans phrase="Text Box"></option>
  <option value="text_short"><mt:trans phrase="Short Text"></option>
  <option id="_new_edit_selection_" value="selection"><mt:trans phrase="Selection"></option>
  <option value="password"><mt:trans phrase="Password"></option>
  <option value="password(hash)"><mt:trans phrase="Password(Hashed)"></option>
  <option value="textarea"><mt:trans phrase="Textarea"></option>
  <option id="_new_edit_richtext_" value="richtext"><mt:trans phrase="RichText"></option>
  <option id="_new_edit_datetime_" value="datetime"><mt:trans phrase="DateTime"></option>
  <option id="_new_edit_color_" value="color"><mt:trans phrase="Color"></option>
  <option value="languages"><mt:trans phrase="Languages"></option>
  <option id="_new_edit_file_" value="file"><mt:trans phrase="File"></option>
  <option value="custom" class="custom"><mt:trans phrase="Custom"></option>
</select>
</td>
<td>
  <button type="button" class="btn btn-outline-danger tr-delete"><mt:trans phrase="Delete"></button>
</td>
<td>
  <button name="_new_detail-" type="button" class="btn btn-outline-primary detail-btn" data-toggle="modal" data-target="#_col_options">
    <mt:trans phrase="Detail">
  </button>
</td>
</tr>
</tbody>
<tfoot>
<mt:var name="column_header">
</tfoot>
</table>
</mt:if>
</mt:objectloop>

<div class="modal fade" id="_col_options" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLongTitle"><mt:trans phrase="Column Detail"></h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="container-fluid">
        <div class="row form-group">
          <div class="col-md-2"><label for="_detail_name"><b><mt:trans phrase="Name"></b></label></div>
          <div class="col-md-4">
          <input id="_detail_id" type="hidden" value="">
          <input id="_detail_name" type="text" class="form-control" value="" readonly>
          </div>
          <div class="col-md-2"><label for="_detail_label"><b><mt:trans phrase="Label"></b></label></div>
          <div class="col-md-4">
          <input id="_detail_label" type="text" class="form-control" value="">
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-2"><label for="_detail_type"><b><mt:trans phrase="Type"></b></label></div>
          <div class="col-md-4">
            <select id="_detail_type" name="_detail_type" class="form-control">
              <option value="integer"><mt:trans phrase="Integer"></option>
              <option value="boolean"><mt:trans phrase="Boolean"></option>
              <option value="string"><mt:trans phrase="String"></option>
              <option value="text"><mt:trans phrase="Large Text"></option>
              <option value="datetime"><mt:trans phrase="DateTime"></option>
              <option value="blob"><mt:trans phrase="Blob"></option>
              <option value="relation"><mt:trans phrase="Relation"></option>
            </select>
          </div>
        <mt:ignore>
          <div class="col-md-2"><b><mt:trans phrase="Size"></b></div>
          <div class="col-md-4">
          <input id="_detail_size" type="number" class="form-control" value="">
          </div>
        </mt:ignore>
          <div class="col-md-2"><label for="_detail_order"><b><mt:trans phrase="Order"></b></label></div>
          <div class="col-md-4">
          <input id="_detail_order" type="number" class="form-control" value="">
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-2"><label for="_detail_not_null"><b><mt:trans phrase="NOT NULL"></b></label></div>
          <div class="col-md-4">
            <label class="custom-control custom-checkbox">
              <input id="_detail_not_null" type="checkbox" class="custom-control-input" name="" value="1">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description"><mt:trans phrase="NOT NULL"></span>
            </label>
          </div>
          <div class="col-md-2"><label for="_detail_index"><b><mt:trans phrase="Index"></b></label></div>
          <div class="col-md-4">
            <label class="custom-control custom-checkbox">
              <input id="_detail_index" type="checkbox" class="custom-control-input" name="" value="1">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description"><mt:trans phrase="Index"></span>
            </label>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-2"><label for="_detail_unique"><b><mt:trans phrase="Unique"></b></label></div>
          <div class="col-md-4">
            <label class="custom-control custom-checkbox">
              <input id="_detail_unique" type="checkbox" class="custom-control-input" name="" value="1">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description"><mt:trans phrase="Unique"></span>
            </label>
          </div>
          <div class="col-md-2"><label for="_detail_unchangeable"><b><mt:trans phrase="Uneditable"></b></label></div>
          <div class="col-md-4">
            <label class="custom-control custom-checkbox">
              <input id="_detail_unchangeable" type="checkbox" class="custom-control-input" name="" value="1">
              <span class="custom-control-indicator"></span>
              <span class="custom-control-description"><mt:trans phrase="Uneditable"></span>
            </label>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-2"><label for="_detail_list"><b><mt:trans phrase="List Type"></b></label></div>
          <div class="col-md-10">
            <select id="_detail_list" name="_detail_list" class="form-control">
              <option value=""><mt:trans phrase="None"></option>
              <option value="checkbox"><mt:trans phrase="Checkbox"></option>
              <option value="number"><mt:trans phrase="Number"></option>
              <option value="primary"><mt:trans phrase="Primary"></option>
              <option value="text"><mt:trans phrase="Text Box"></option>
              <option value="text_short"><mt:trans phrase="Short Text"></option>
              <option value="password"><mt:trans phrase="Password"></option>
              <option value="datetime"><mt:trans phrase="DateTime"></option>
              <option value="date"><mt:trans phrase="Date"></option>
              <option value="popover"><mt:trans phrase="Popover"></option>
              <option id="_detail_list_reference" value="reference"><mt:trans phrase="Reference"></option>
            </select>
          <div class="sub-col row form-group hidden" id="_detail_list_table_wrapper">
            <div class="col-md-3"><label for="_detail_list_table"><b><mt:trans phrase="Model"></b></label></div>
            <div class="col-md-9">
            <select id="_detail_list_table" class="form-control">
              <mt:objectloop model="table" sort_by="order">
              <mt:var name="label" setvar="table_label">
              <option value="<mt:var name="name" escape>"><mt:trans phrase="$table_label" escape></option>
              </mt:objectloop>
            </select>
            </div>
            <div class="col-md-3"><label for="_detail_list_column"><b><mt:trans phrase="Column"></b></label></div>
            <div class="col-md-9">
            <select id="_detail_list_column" class="form-control">
            </select>
            </div>
          </div>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-2"><label for="_detail_edit"><b><mt:trans phrase="Edit Type"></b></label></div>
          <div class="col-md-10">
            <select id="_detail_edit" name="_detail_edit" class="form-control">
              <option value=""><mt:trans phrase="None"></option>
              <option value="hidden"><mt:trans phrase="Hidden"></option>
              <option value="checkbox" selected><mt:trans phrase="Checkbox"></option>
              <option value="number"><mt:trans phrase="Number"></option>
              <option value="primary"><mt:trans phrase="Primary"></option>
              <option value="text"><mt:trans phrase="Text Box"></option>
              <option value="text_short"><mt:trans phrase="Short Text"></option>
              <option id="_detail_edit_selection" value="selection"><mt:trans phrase="Selection"></option>
              <option value="password"><mt:trans phrase="Password"></option>
              <option value="password(hash)"><mt:trans phrase="Password(Hashed)"></option>
              <option value="textarea"><mt:trans phrase="Textarea"></option>
              <option id="_detail_edit_richtext" value="richtext"><mt:trans phrase="RichText"></option>
              <option value="datetime"><mt:trans phrase="DateTime"></option>
              <option value="color"><mt:trans phrase="Color"></option>
              <option value="languages"><mt:trans phrase="Languages"></option>
              <option id="_detail_edit_file" value="file"><mt:trans phrase="File"></option>
              <option id="_detail_edit_relation" value="relation"><mt:trans phrase="Relation"></option>
              <option id="_detail_edit_reference" value="reference"><mt:trans phrase="Reference"></option>
            </select>
          <div class="sub-col row form-group hidden" id="_detail_edit_table_wrapper">
            <div class="col-md-3"><label for="_detail_edit_table"><b><mt:trans phrase="Model"></b></label></div>
            <div class="col-md-9">
            <select id="_detail_edit_table" class="form-control">
              <mt:objectloop model="table" sort_by="order">
              <mt:var name="label" setvar="table_label">
              <option value="<mt:var name="name" escape>"><mt:trans phrase="$table_label" escape></option>
              </mt:objectloop>
            </select>
            </div>
            <div class="col-md-3"><label for="_detail_edit_column"><b><mt:trans phrase="Column"></b></label></div>
            <div class="col-md-9">
            <select id="_detail_edit_column" class="form-control">
            </select>
            </div>
            <div class="col-md-3 _detail_edit_type_wrapper"><label for="_detail_edit_type"><b><mt:trans phrase="Type"></b></label></div>
            <div class="col-md-9 _detail_edit_type_wrapper">
            <select id="_detail_edit_type" class="form-control">
              <option value="radio"><mt:trans phrase="Radio Buttons"></option>
              <option value="select"><mt:trans phrase="Dropdown"></option>
              <option value="dialog"><mt:trans phrase="Dialog"></option>
              <option value="checkbox"><mt:trans phrase="Checkbox"></option>
            </select>
            </div>
          </div>
          <div class="sub-col _detail_edit_options_wrapper">
            <div class="col-md-3">
              <label for="_detail_options"><b id="detail_options_label"><mt:trans phrase="Option"></b></label>
            </div>
            <div class="col-md-9">
              <input id="_detail_options" type="text" class="form-control" value="">
              <small id="_detail_edit_options_hint" class="font-italic"></small>
            </div>
            <div class="col-md-3 _detail_edit_selections_wrapper hidden">
              <label for="_detail_disp_edit"><b><mt:trans phrase="Type"></b></label>
            </div>
            <div class="col-md-9 _detail_edit_selections_wrapper hidden">
            <select id="_detail_disp_edit" class="form-control">
              <option value="radio"><mt:trans phrase="Radio Buttons"></option>
              <option value="select"><mt:trans phrase="Dropdown"></option>
              <option value="checkbox"><mt:trans phrase="Checkboxes"></option>
            </select>
            </div>
          </div>
          <div class="sub-col row form-group _detail_file_wrapper hidden">
            <div class="col-md-3"><label for="_detail_file_type"><b><mt:trans phrase="Type"></b></label></div>
            <div class="col-md-9">
            <select id="_detail_file_type" class="form-control">
              <option value=""><mt:trans phrase="Any"></option>
              <option value="image"><mt:trans phrase="Image"></option>
              <option value="video"><mt:trans phrase="Video"></option>
              <option value="audio"><mt:trans phrase="Audio"></option>
              <option value="pdf"><mt:trans phrase="PDF"></option>
            </select>
            </div>
          </div>
          <div class="sub-col row form-group _detail_readonly_wrapper">
            <div class="col-md-3"><label for="_detail_autoset"><b><mt:trans phrase="Read-Only"></b></label></div>
            <div class="col-md-9">
                <label class="custom-control custom-checkbox">
                  <input id="_detail_autoset" type="checkbox" class="custom-control-input" name="<mt:var name="name" escape>" value="1">
                  <span class="custom-control-indicator"></span>
                  <span class="custom-control-description"><mt:trans phrase="Read-Only"></span>
                </label>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal"><mt:trans phrase="Cancel"></button>
      <button type="button" class="btn btn-primary" id="_save_detail_button" data-dismiss="modal"><mt:trans phrase="Save Changes"></button>
    </div>
  </div>
</div>
</div>

<script>
$('#_detail_type').change( function(){
    toggle_detail_custom( $(this).val() );
});
$('.list_edit_prop').change( function() {
    var options = '';
    var name = $(this).prop('id');
    var term = name.split('_');
    var number;
    if ( term[1]=='edit') {
        number = term[2];
    } else {
        number = term[3];
    }
    var prefix = '_';
    var postfix = '_';
    if ( term[1] != 'edit') {
        prefix = '_new_';
    }
    var current_val = $('#' + prefix + 'options' + postfix + number).val();
    if ($(this).val() == 'selection') {
        options = prompt('<mt:trans phrase="Please enter options for this field as a comma delimited list.">', current_val);
    } else if ($(this).val() == 'richtext' || $(this).val() == 'textarea') {
        if (! current_val || ( current_val.indexOf(',') != -1 ) ) {
            current_val = 10;
        }
        options = prompt('<mt:trans phrase="Please specify the height of the editor.">', current_val );
    }
    if ( options ){
        $('#' + prefix + 'options' + postfix + number).val(options);
        if ($(this).val() == 'selection') {
            var disp_edit = $('#'+prefix + 'disp_edit' + postfix + number).val();
            if (! disp_edit ) {
                disp_edit = 'radio';
            }
            options = prompt('<mt:trans phrase="Please specify the type of selection. You can specify radio, option, or select.">', disp_edit );
            if ( options ) {
                $('#' + prefix + 'disp_edit' + postfix + number).val(options);
            }
        }
    }
});
function toggle_detail_custom( type ) {
    $('#_detail_edit_options_hint').html('');
    $('._detail_readonly_wrapper').show();
    if ( type == 'text') {
        $('#_detail_edit_richtext').show();
        $('._detail_edit_options_wrapper').show();
        if ( $('#_detail_edit_richtext').prop('selected') ) {
            $('._detail_readonly_wrapper').hide();
        }
    } else {
        if ( $('#_detail_edit_richtext').prop('selected') ) {
            $('#_detail_edit').val('');
        }
        $('#_detail_edit_richtext').hide();
    }
    if ( type == 'text' || type == 'blob') {
        $('#_detail_index').prop('disabled', 'disabled');
        $('#_detail_index').prop('checked', false);
    } else {
        $('#_detail_index').removeAttr('disabled');
    }
    if ( type == 'string' || type == 'integer' ) {
        $('#_detail_edit_selection').show();
    } else {
        if ( $('#_detail_edit_selection').prop('selected') ) {
            $('#_detail_edit').val('');
        }
        $('#_detail_edit_selection').hide();
    }
    if ( $('#_detail_edit').val() == 'selection' || $('#_detail_edit').val() == 'richtext' 
         || $('#_detail_edit').val() == 'textarea') {
        if ( $('#_detail_edit').val() != 'selection') {
            $('#detail_options_label').html('<mt:trans phrase="Editor Height">');
            $('#_detail_options').prop('type', 'number');
            $('._detail_edit_selections_wrapper').hide();
        } else {
            $('#detail_options_label').html('<mt:trans phrase="Option">');
            $('#_detail_options').prop('type', 'text');
            $('._detail_edit_selections_wrapper').show();
            $('._detail_edit_options_wrapper').show();
            $('#_detail_edit_options_hint').html('<mt:trans phrase="Please enter options for this field as a comma delimited list.">');
        }
    } else {
        $('._detail_edit_options_wrapper').hide();
        $('._detail_edit_selections_wrapper').hide();
    }
    if ( type == 'integer' || type == 'relation' ){
        $('#_detail_edit_reference').show();
        $('#_detail_edit_relation').show();
        $('#_detail_list_reference').show();
    } else {
        $('#_detail_edit_reference').hide();
        $('#_detail_edit_relation').hide();
        $('#_detail_list_reference').hide();
        if ($('#_detail_edit_relation').prop('selected') || $('#_detail_edit_reference').prop('selected') ) {
          $('#_detail_edit').val('');
          $('#_detail_edit_table_wrapper').hide();
          $('._detail_edit_type_wrapper').hide();
        }
        if ( $('#_detail_list_reference').prop('selected') ) {
          $('#_detail_list').val('');
          $('#_detail_list_table_wrapper').hide();
        }
    }
    if ( type == 'blob') {
        $('#_detail_edit_file').show();
        if ( $('#_detail_edit_file').prop('selected') ){
            $('._detail_file_wrapper').show();
            $('._detail_readonly_wrapper').hide();
        }
    } else {
        $('#_detail_edit_file').hide();
        if ( $('#_detail_edit_file').prop('selected') ) {
            $('#_detail_edit').val('');
            $('._detail_file_wrapper').hide();
        }
    }
}
$('#_detail_list').change( function(){
    if ( $(this).val() == 'reference') {
        $('#_detail_list_table_wrapper').show();
        var colmns = $('#_detail_list_column').children();
        if ( colmns.length == 0 ) {
            set_column_names( $('#_detail_edit_table').val(), 'list');
        }
    } else {
        $('#_detail_list_table_wrapper').hide();
    }
});
$('#_detail_edit').change( function(){
    toggle_detail_custom( $('#_detail_type').val() );
    if ( $(this).val() == 'relation' || $(this).val() == 'reference') {
        $('#_detail_edit_table_wrapper').show();
        if ( $(this).val() == 'relation') {
            $('._detail_edit_type_wrapper').show();
        } else {
            $('._detail_edit_type_wrapper').hide();
        }
        var colmns = $('#_detail_edit_column').children();
        if ( colmns.length == 0 ) {
            set_column_names( $('#_detail_edit_table').val(), 'edit');
        }
    } else {
        $('#_detail_edit_table_wrapper').hide();
        $('._detail_edit_type_wrapper').hide();
    }
});
$('#_detail_list_table').change( function(){
    set_column_names( $(this).val(), 'list');
    $('#_detail_edit_table').val( $(this).val() );
});
$('#_detail_edit_table').change( function(){
    set_column_names( $(this).val(), 'edit');
    $('#_detail_list_table').val( $(this).val() );
});
$('#_save_detail_button').click( function(){
    var name = $('#_detail_id').val();
    var term = name.split('-');
    var number = term[1];
    var prefix = '_';
    var postfix = '_';
    if ( term[0] != '_detail') {
        prefix = '_new_';
    }
    var items = ['name','label','type','order','options','disp_edit'];
    $.each( items, function( index, name ) {
        $('#' + prefix + name + postfix + number ).val( $('#_detail_' + name ).val() );
    });
    if( $('#_detail_autoset').prop('checked') ) {
        $('#' + prefix + 'autoset' + postfix + number).val(1);
    } else {
        $('#' + prefix + 'autoset' + postfix + number).val('');
    }
    items = ['not_null','index','unique','unchangeable'];
    $.each( items, function( index, name ) {
        $('#' + prefix + name + postfix + number).prop('checked', $('#_detail_' + name).prop('checked') );
    });
    var list = $('#_detail_list').val();
    if ( list == 'reference') {
        var model = $('#_detail_list_table').val();
        var column = $('#_detail_list_column').val();
        var list_value = list+ ':' + model + ':' + column;
        if (! model || !column ) {
            alert('<mt:trans phrase="Model and Column are required for the reference.">');
            return false;
        }
        var list_options = $('#' + prefix + 'list' + postfix + number ).children();
        for ( var i = 0; i < list_options.length; i++ ) {
            if (list_options.eq(i).text()=='<mt:trans phrase="Custom">') {
                list_options.eq(i).val( list_value );
                list_options.eq(i).prop('selected', true );
            }
        }
    } else {
        $('#' + prefix + 'list' + postfix + number ).val( list );
    }
    var edit = $('#_detail_edit').val();
    if ( edit == 'reference' || edit == 'relation') {
        var model = $('#_detail_edit_table').val();
        var column = $('#_detail_edit_column').val();
        var type = $('#_detail_edit_type').val();
        var edit_value = edit + ':' + model + ':' + column;
        if ( edit == 'reference' && (! model || !column ) ) {
            alert('<mt:trans phrase="Model and Column are required for the reference.">');
            return false;
        }
        if ( edit == 'relation' && (! model || !column || !type ) ) {
            alert('<mt:trans phrase="Model, Column and Type are required for the relation.">');
            return false;
        }
        if ( edit == 'relation') {
            edit_value = edit_value + ':' + type;
        }
        var edit_options = $('#' + prefix + 'edit' + postfix + number ).children();
        for ( var i = 0; i < edit_options.length; i++ ) {
            if ( edit_options.eq(i).text() == '<mt:trans phrase="Custom">') {
                edit_options.eq(i).val( edit_value );
                edit_options.eq(i).prop('selected', true );
            }
        }
    } else {
        $('#' + prefix + 'edit' + postfix + number ).val( edit );
    }
    var type = $('#_detail_type').val();
    if ( type == 'relation' ) {
        var model_e = $('#_detail_edit_table').val();
        var model_l = $('#_detail_list_table').val();
        var detail_e = $('#_detail_edit').val();
        var detail_l = $('#_detail_list').val();
        if ( detail_e != 'relation' && detail_l != 'relation' ) {
            alert('<mt:trans phrase="Model, column and type are required for the relation.">');
            return false;
        }
        var model;
        if ( detail_e == 'relation' ) {
            model = model_e;
        } else {
            model = detail_l;
        }
        if (! model ) {
            alert('<mt:trans phrase="Model, column and type are required for the relation.">');
            return false;
        }
        $('#' + prefix + 'options' + postfix + number ).val( model );
    }
    if ( list == 'reference' && ( edit == 'reference' || edit == 'relation') ) {
        if( $('#_detail_edit_table').val() != $('#_detail_list_table').val() ) {
            alert('<mt:trans phrase="The Model names of the list type and edit type do not match.">');
            return false;
        }
    }
    if ( edit == 'file'){
        $('#' + prefix + 'options' + postfix + number ).val( $('#_detail_file_type').val() );
    }
});
$('select').focus( function(){
    $(this).prop('original', $(this).val() );
});
$('select').change( function(){
    if ( $(this).val()=='custom') {
        alert('<mt:trans phrase="Click Detail button to continue settings.">');
    }
});
$('.tr-delete').click( function(){
    if( !confirm('<mt:trans phrase="Are you sure you want to remove this Column?">') ) {
        return false;
    }
    $(this).parent().parent().remove();
    reorder();
});
$('.detail-btn').click( function(){
    var name = $(this).prop('name');
    $('#_detail_list_column option').remove();
    $('#_detail_edit_column option').remove();
    $('#_detail_id').val( name );
    var term = name.split('-');
    var number = term[1];
    var prefix = '_';
    var postfix = '_';
    if ( term[0]!= '_detail') {
        prefix = '_new_';
    }
    var items = ['name','label','type','order','options','disp_edit'];
    $.each( items, function( index, name ) {
        $('#_detail_' + name ).val($('#' + prefix + name + postfix + number ).val() );
    });
    if ( $('#' + prefix + 'autoset' + postfix + number ).val() == 1 ) {
        $('#_detail_autoset').prop('checked', true );
    } else {
        $('#_detail_autoset').prop('checked', false );
    }
    items = ['not_null','index','unique','unchangeable'];
    $.each( items, function( index, name ) {
        $('#_detail_' + name ).prop('checked', $('#' + prefix + name + postfix + number).prop('checked') );
    });
    var prop_list = $('#' + prefix + 'list' + postfix + number ).val();
    var prop_edit = $('#' + prefix + 'edit' + postfix + number ).val();
    if ( prop_list.indexOf(':') == -1 ) {
        $('#_detail_list').val( prop_list );
        $('#_detail_list_table_wrapper').hide();
    } else {
        var list_props = prop_list.split(':');
        if ( list_props[0] == 'reference'){
            $('#_detail_list').val('reference');
            var model = list_props[1];
            var column = list_props[2];
            $('#_detail_list_table').val( model );
            $('#_detail_list_table_wrapper').show();
            set_column_names( model, 'list', column );
        }
    }
    if ( prop_edit.indexOf(':') == -1 ) {
        $('#_detail_edit').val(prop_edit);
        $('#_detail_edit_table_wrapper').hide();
        $('._detail_edit_type_wrapper').hide();
    } else {
        var edit_props = prop_edit.split(':');
        if ( edit_props[0] == 'relation' || edit_props[0] == 'reference') {
            $('#_detail_edit').val( edit_props[0] );
            var model = edit_props[1];
            var column = edit_props[2];
            var type = edit_props[3];
            $('#_detail_edit_table').val( model );
            $('#_detail_edit_type').val( type );
            $('#_detail_edit_table_wrapper').show();
            if ( edit_props[0] == 'relation') {
                $('._detail_edit_type_wrapper').show();
            } else {
                $('._detail_edit_type_wrapper').hide();
            }
            set_column_names( model, 'edit', column );
        }
    }
    if( prop_edit == 'file') {
        $('#_detail_file_type').val( $('#' + prefix + 'options' + postfix + number ).val() );
    }
    toggle_detail_custom( $('#' + prefix + 'type' + postfix + number ).val() );
});
$('#cols_tbl').sortable ( {
    stop: function( evt, ui ) {
        reorder();
    }
});
function reorder() {
    var i = 0;
    $('.order_col').each( function(){
        i++;
        if ( $(this).is(':visible') ) {
            $(this).prop('value', i );
        }
    });
}
var addcounter = 0;
var last_row = false;
$('#add_col').click( function(){
    tr = $('#col_tmpl');
    newline = tr.clone( true ).appendTo('#cols_tbl');
    newline.removeAttr('id');
    newline.show();
    inputs = newline.find('input');
    addcounter++;
    var focusobj = false;
    inputs.each(function(){
        name = $(this).prop('name');
        if( name == '_new_column[]'){
            $(this).prop('value', addcounter );
        } else {
            if( name == '_new_order_'){
                $(this).addClass('order_col');
            }
            $(this).prop('name', name + addcounter );
            $(this).prop('id', name + addcounter );
            if(! focusobj ){
                focusobj = $(this);
            }
            if ($(this).prop('type') == 'checkbox') {
                $(this).prop('checked', false );
            } else {
                $(this).val('');
            }
        }
    });
    selects = newline.find('select');
    selects.each( function() {
        name = $(this).prop('name');
        $(this).prop('name', name + addcounter );
        $(this).prop('id', name + addcounter );
        $(this).children('option').each( function() {
            if ( $(this).prop('id') ) {
                $(this).prop('id', $(this).prop('id') + addcounter );
            }
        });
    });
    buttons = newline.find('button');
    buttons.each( function(){
        name = $(this).prop('name');
        $(this).prop('name', name + addcounter );
        $(this).prop('id', name + addcounter );
    });
    reorder();
    focusobj.focus();
});
function set_column_names( model, type, column ) {
    $('#_detail_' + type + '_column option').remove(); // todo magic_token
    $.getJSON('<mt:var name="script_uri">?__mode=get_json&_model=' + model, function( data ) {
        $.each( data.labels, function( key, val ) {
            var sele = false;
            if ( key == column ) {
                sele = true;
            }
            option = $('<option>').val( key ).text( val ).prop('selected', sele );
            $('#_detail_' + type + '_column').append( option );
        });
    });
}
$('.col_types').each( function(){
    set_prop_from_type( $(this) );
});
$('.col_types').change( function(){
    set_prop_from_type( $(this) );
    if ($(this).val() == 'relation') {
        var name = $(this).prop('id');
        var term = name.split('_');
        var number;
        if ( term[1]=='type') {
            number = term[2];
        } else {
            number = term[3];
        }
        var prefix = '_';
        var postfix = '_';
        if ( term[1] != 'type') {
            prefix = '_new_';
        }
        var current_val = $('#' + prefix + 'options' + postfix + number).val();
        options = prompt('<mt:trans phrase="Please specify the Model name.">', current_val );
        if ( options ) {
            $('#' + prefix + 'options' + postfix + number).val(options);
        }
    }
    return true;
});
function set_prop_from_type( obj ) {
    var name = obj.prop('id');
    var term = name.split('_');
    var number;
    if( term[1]=='type') {
        number = term[2];
    }else{
        number = term[3];
    }
    var prefix = '_';
    var postfix = '_';
    if( term[1] != 'type') {
        prefix = '_new_';
    }
    var type = obj.val();
    var list_prop = $('#' + prefix + 'list' + postfix + number ).val();
    var edit_prop = $('#' + prefix + 'edit' + postfix + number ).val();
    if ( type == 'datetime') {
        $('#' + prefix + 'list_datetime' + postfix + number ).show();
        $('#' + prefix + 'edit_datetime' + postfix + number ).show();
    } else {
        if ( list_prop == 'datetime') {
            $('#' + prefix + 'list' + postfix + number ).val('');
        }
        if ( edit_prop == 'datetime') {
            $('#' + prefix + 'edit' + postfix + number ).val('');
        }
        $('#' + prefix + 'list_datetime' + postfix + number ).hide();
        $('#' + prefix + 'edit_datetime' + postfix + number ).hide();
    }
    if ( type == 'blob') {
        $('#' + prefix + 'edit_file' + postfix + number ).show();
    } else {
        if ( edit_prop == 'file') {
            $('#' + prefix + 'edit_file' + postfix + number ).val('');
        }
        $('#' + prefix + 'edit_file' + postfix + number ).hide();
    }
    if ( type == 'text') {
      $('#' + prefix + 'edit_richtext' + postfix + number ).show();
    } else {
        if ( edit_prop == 'richtext') {
            $('#' + prefix + 'edit_richtext' + postfix + number ).val('');
        }
        $('#' + prefix + 'edit_richtext' + postfix + number ).hide();
    }
}
</script>